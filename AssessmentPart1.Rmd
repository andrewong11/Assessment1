---
title: "Assessment Part 1"
author: "Andrew Wong Weng Seng, UCL MSc SCUA"
output:
  html_notebook:
    theme: cerulean
  html_document:
    df_print: paged
  word_document: default
bibliography: Assessment1references.bib
---

```{r global options, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Spatial correlation between female literacy and proportion of households with electricity in Afghanistan? {.tabset}

### Written Evaluation 

Word count: 597

This research analysed 2015 sub-region data from Afghanistan, reported by the Department of Health Surveys [@spatial_data_repository_2015_nodate]. With this data, the spotlight was shone on the potential spatial correlation between female literacy and household access to electricity, which can be a measure of modernisation and development [@desai_urbanisation_2012]. QGIS and R were used to explore, visualize and compare the female literacy rates and household access to electricity, across sub-regions in Afghanistan. It is critical to remind readers that this study does not intend to prove statistical causation but is solely intended to visualize a potential spatial correlation. 

The study began by using QGIS to read shapefiles downloaded from the Spatial Data Repository. However, there were many fields with incomplete data. These fields include the maternal mortality rates and HIV-prevalence indicators and missing values were indicated by ‘9999’. Since the fields of interest (female literacy: ‘EDLITRWLIT’, household electricity: ‘HCELECHELC’) were complete, no interpolations were required to fill in missing data. Following the data inspection, 2 identical maps were used to produce a choropleth map visualising two variables. To ensure that the map portrayed the correlation in question, the sub-regions with less than 50% of households with electricity were highlighted through rule-based graduated symbology. Bins of observations were created with jenks natural breaks classification. Transparencies and symbols were adjusted and the QGIS map was generated, with appropriate map elements. Finally, the map was embedded into Rmarkdown [@dennett_producing_2018].

The initial R attempt to produce the map utilised the ‘tmap’ R-package. However, the end-product was considered to be unsatisfactory on an aesthetic level, and could have been more intuitive. Making fine adjustments required an in-depth knowledge of the extensive R-package documentation. After consulting with peers and the ‘leaflet’ practical package by Dennett [-@dennett_practical_2018], a second attempt was made to maximise the potential of the ‘leaflet’ package. Bins of observations were determined by calculating quantiles instead of jenks, and other map elements were added to produce a more comprehensive and intuitive map. This created an interactive map with pop-up labels and multiple overlays by using the ‘addLayersControl’ function [@noauthor_leaflet_nodate]. This allows the user to select the variable to be visualised, to zoom-in, and to choose the type of basemap (ESRI gray canvas / topographic map). 

With the maps displayed in the above tabs, it is now crucial to evaluate the limitations of the data used. Although we do not have the data collection methodology, we can speculate that one probable limitation is the geo-political situation within Afghanistan which could lead to the under-reporting of female literacy rates. The accuracy of data collection might also be compromised by security challenges. These uncertainties should be factored in further analysis.

The process of using two different approaches to produce a map researching the same question has illuminated the benefits and drawbacks of each approach. The essential process of cleaning, processing and analysing data is significantly easier with R-packages. Furthermore, R is much better at handling large datasets than GIS software. However, minute adjustments in producing a map are easier in QGIS because of the intuitive and friendly user-interface, which ensures a smooth navigation and provides immediate updates with each change. For R, the smallest of changes requires the cartographer to be aware of and edit the intricate R-documentation for each function within each package, before re-running chunks of code. This can be a time-consuming endeavour, albeit becoming more intuitive with experience and practice. Overall, there are advantages and disadvantages with each platform, but these serve to emphasise their complementarity. The choice of program ultimately depends on the structure of the data, the cartographer’s task, experience and preference. 

### QGIS Map

```{r Embedding Map generated by QGIS, echo=FALSE}
library(knitr)
knitr::include_graphics('afghan_latest.jpg')
```

```{r R-generation of Map, include=FALSE}

library(maptools)
library(RColorBrewer)
library(classInt)
library(OpenStreetMap)
library(rJava)
library(sp)
library(rgeos)
library(tmap)
library(tmaptools)
library(sf)
library(rgdal)
library(geojsonio)
library(ggplot2)
library(shiny)
library(shinyjs)
library(dplyr)
library(tidyverse)
library(maps)
library(leaflet)
library(sf)
library(sp)
library(magrittr)
library(prettydoc)
library(citr)

##### Reading shapefile used in QGIS into R ####
afghanmap <- read_shape("sdr_subnational_data_dhs_2015.shp", as.sf = TRUE)
afghan_lowelec <- afghanmap %>% filter(HCELECHELC<50)

# Making maps
afghan_osm <- read_osm(afghanmap, type = "esri", zoom = NULL)

```

```{r Generation of map with TMAP, eval=FALSE, include=FALSE}
##### Plotting with TMAP -- I did not find the map produced with this package very aesthetic and intuitive. Thus, I tried Leaflet in the next section instead.  #####
tmap_mode("plot")
tm_shape(afghanmap) +
  tm_polygons("EDLITRWLIT",
             style = "jenks",
             palette = "YlOrBr",
             midpoint = NA,
             border.col = "black",
             border.lwd = 0.5,
             title = "Female literacy (%)") +
  tm_text("DHSREGEN", size = 0.4, col = "black") +
tm_shape(afghan_lowelec) +
  tm_fill("HCELECHELC", alpha = 1, title = "Households with electricity") +
  tm_borders(col="black",lwd=2.0) +
  tm_text("DHSREGEN", size = 0.4, col = "black")
```

### R Leaflet Map

```{r, echo=TRUE}
##### Plotting with LEAFLET #####
library(leaflet)
afghanmapSP <- afghanmap %>%
  st_transform(crs = 4326) %>%
  as("Spatial")
afghan_lowelecSP <- afghan_lowelec %>%
  st_transform(crs = 4326) %>%
  as("Spatial")

breaks<-classIntervals(afghanmap$EDLITRWLIT, n=5, style="quantile")
breaks <- breaks$brks

breaks1 <- classIntervals(afghan_lowelec$HCELECHELC, n=5, style="quantile")
breaks1 <- breaks1$brks

pal <- colorBin(palette = "OrRd", 
                domain = afghanmapSP$EDLITRWLIT,
                bins = breaks,
                reverse = TRUE)

pal1 <- colorBin(palette = "Greys",
                 domain = afghan_lowelecSP$HCELECHELC,
                 bins = breaks1,
                 reverse = TRUE)

leafletmap <- leaflet(width = "100%") %>%
  addPolygons(data = afghanmapSP, 
              stroke = FALSE,
              fillOpacity = 0.8,
              smoothFactor = 0.5,
              fillColor = ~pal(EDLITRWLIT),
              popup = ~DHSREGEN,
              group = "Female Literacy rates"
  ) %>%
  addLegend(data = afghanmapSP,
            "bottomright",
            pal = pal,
            values = ~EDLITRWLIT,
            title = "Female Literacy rates (%)",
            opacity = 1.0,
            group = "Female Literacy rates") %>%
  addScaleBar(position = c("bottomleft"),
              options = scaleBarOptions(maxWidth = 200, metric = TRUE, updateWhenIdle = TRUE)) %>%
  addProviderTiles("Esri.WorldGrayCanvas", group = "Light basemap") %>%
  addProviderTiles("Esri.WorldTopoMap", group = "Topograph basemap") %>%
  addPolygons(data = afghan_lowelecSP,
              stroke = TRUE,
              color = "black",
              weight = 3,
              fillOpacity = 1,
              smoothFactor = 0.5,
              fillColor = ~pal1(HCELECHELC),
              popup = ~DHSREGEN,
              group = "Sub-regions with <50% Households with electricity"
  ) %>%
  addLegend(data = afghan_lowelecSP,
            "topright",
            pal = pal1,
            values = ~HCELECHELC,
            title = "Sub-regions with <50% Households with electricity",
            opacity = 1.0,
            group = "Sub-regions with <50% Households with electricity") %>%
  addLayersControl(
    baseGroups = c("Light basemap", "Topograph basemap"),
    overlayGroups = c("Female Literacy rates","Sub-regions with <50% Households with electricity"),
    position = c("topleft"),
    options = layersControlOptions(collapsed = TRUE, autoZIndex = TRUE)
  )
leafletmap
```

### Bibliography
